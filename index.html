<!DOCTYPE html>
<html>
<head>
    <title>Flow Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-canvas-flowmap-layer/dist/leaflet.canvasflowmaplayer.min.js"></script>
</head>
<body>
    <div id="map" style="width: 100%; height: 600px;"></div>
    <script>
        // Initialize the map
        var map = L.map('map').setView([34.5, 69.0], 6);

        // Add a tile layer to the map
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Data from the CSV
        var data = [
            { "s_State": "Abu Nasr Farahi", "s_Volume": 40610, "s_state_id": "AFG1", "s_lat": 32.165039, "s_lon": 60.873467, "e_locality": "Kabul", "e_locality_id": "AF01", "e_lat": 34.498247, "e_lon": 69.589362, "e_Volume": 15 },
            { "s_State": "Abu Nasr Farahi", "s_Volume": 2250, "s_state_id": "AFG1", "s_lat": 32.165039, "s_lon": 60.873467, "e_locality": "Wardak", "e_locality_id": "AF02", "e_lat": 33.990654, "e_lon": 68.504375, "e_Volume": 5 },
            { "s_State": "Abu Nasr Farahi", "s_Volume": 665, "s_state_id": "AFG1", "s_lat": 32.165039, "s_lon": 60.873467, "e_locality": "Ghazni", "e_locality_id": "AF03", "e_lat": 33.086709, "e_lon": 67.767134, "e_Volume": 5 },
            { "s_State": "Abu Nasr Farahi", "s_Volume": 1250, "s_state_id": "AFG1", "s_lat": 32.165039, "s_lon": 60.873467, "e_locality": "Paktya", "e_locality_id": "AF04", "e_lat": 35.142430, "e_lon": 71.400403, "e_Volume": 5 },
            { "s_State": "Abu Nasr Farahi", "s_Volume": 31560, "s_state_id": "AFG1", "s_lat": 32.165039, "s_lon": 60.873467, "e_locality": "Ghor", "e_locality_id": "AF05", "e_lat": 33.132149, "e_lon": 66.578813, "e_Volume": 5 }
        ];

        // Convert the data into GeoJSON format
        var geoJsonData = {
            "type": "FeatureCollection",
            "features": data.map(function (item) {
                return {
                    "type": "Feature",
                    "properties": {
                        "origin": item.s_State,
                        "destination": item.e_locality,
                        "volume": item.e_Volume
                    },
                    "geometry": {
                        "type": "LineString",
                        "coordinates": [
                            [item.s_lon, item.s_lat],
                            [item.e_lon, item.e_lat]
                        ]
                    }
                };
            })
        };

        // Add the CanvasFlowmapLayer
        var flowmapLayer = L.canvasFlowmapLayer(geoJsonData, {
            originAndDestinationFieldIds: {
                originUniqueIdField: 'origin',
                originGeometry: {
                    x: 's_lon',
                    y: 's_lat'
                },
                destinationUniqueIdField: 'destination',
                destinationGeometry: {
                    x: 'e_lon',
                    y: 'e_lat'
                }
            },
            canvasBezierStyle: {
                type: 'solid',
                strokeStyle: '#0000FF',
                lineWidth: 1,
                lineCap: 'round',
                lineJoin: 'round'
            }
        }).addTo(map);
    </script>
</body>
</html>
